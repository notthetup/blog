---
layout: post
title: Streaming Audio from Mumble using IceCast
categories:
- Audio
- Dev
- Tech
tags: []
status: publish
type: post
published: true
meta:
  _edit_last: '1'
  _social_aggregation_next_run: '1383492236'
  _wpas_done_all: '1'
  _social_notify: '1'
  _wp-svbtle-kudos: '6'
author:
  login: chinpen
  email: chinpen@chinpen.net
  display_name: chinpen
  first_name: Chin
  last_name: Pen
---
<p>For my<a href="http://live.webuild.sg"> new (it's almost 3 months old already) podcast</a> we had an idea of streaming the recording live. Also I had decided to leave Skype for <a href="http://mumble.sourceforge.net/">Mumble</a>. Skype was getting too unreliable and Mumble supported<a href="http://blog.mumble.info/for-the-record/"> separate channel recording</a> for each connected client, which would make post processing much simpler.</p>
<p>So I setup a spare box (Pentium(R) Dual-Core E6300, 4GB) to run <a href="https://www.archlinux.org/">Archlinux</a> (which turned out to be kind of a bad idea in the end). I am lucky to get a pseudo-static IP from my ISP but I got <a href="https://wiki.archlinux.org/index.php/Dynamic_DNS">Dynamic DNS </a>setup using <a href="http://sourceforge.net/p/ddclient/wiki/Home/">ddclient</a> just incase.</p>
<p><img class="aligncenter size-medium wp-image-3734" alt="server" src="http://chinpen.net/blog/wp-content/uploads/2013/11/server-236x300.jpg" width="236" height="300" /></p>
<p>Next was to run a <a href="http://mumble.sourceforge.net/Running_Murmur">Mumble server (Murmur)</a>. It's pretty easy to setup and usually has been downstreamed to the most distro repos. I setup a single "room" on the server and ensured the server was password protected. With that I was able to connect using the Mumble clients inside and outside my network and have a proper podcast recording at high quality. With some port forwarding on my router I had the server accessible from outside. <a href="https://wiki.archlinux.org/index.php/iptables">iptables</a> were of course necessary to keep the naughty people away.</p>
<p style="text-align: center;"><a href="http://chinpen.net/blog/wp-content/uploads/2013/11/murmur.png"><img class="aligncenter size-medium wp-image-3729" alt="murmur" src="http://chinpen.net/blog/wp-content/uploads/2013/11/murmur-300x202.png" width="300" height="202" /></a></p>
<p><a href="http://icecast.org">Icecast</a> was the obvious option for the streaming bit. It's pretty easy to setup (again look in your repos) and has a ton of features to control the audio quality and other server settings. Again port forwarding was needed for the Icecast server as well.</p>
<p style="text-align: center;"><a href="http://chinpen.net/blog/wp-content/uploads/2013/11/archbox.png"><img class="aligncenter size-medium wp-image-3733" alt="icecase" src="http://chinpen.net/blog/wp-content/uploads/2013/11/archbox-300x203.png" width="300" height="203" /></a></p>
<p>The only interesting issue here was streaming music. We wanted to stream Creative Commons Music before and after the live recording, so I set up <a href="http://www.icecast.org/ices.php">ices0 source client</a> to stream music from <a href="http://ccmixter.org">CCMixter</a>. But thanks to <a href="https://developer.mozilla.org/en-US/docs/HTML/Supported_media_formats">FF on OSX not supporting mp3 </a>(it's supposed to change soon), I had to also run an <a href="http://www.icecast.org/ices.php">ices2</a> instance streaming ogg music for everyone on FF.</p>
<p>So next, streaming the actual Mumble conversation out. How do I stream the audio out? Mumble or Murmur don't really have an elegant way to pipe out the audio. But I found a way to use <a href="http://www.freedesktop.org/wiki/Software/PulseAudio/">Pulse Audio</a> to basically "pipe" audio from a Mumble client using an Icecast source client called <a href="https://code.google.com/p/darkice/">DarkIce</a>.</p>
<p>The couple of hoops one has to be jump through to get this work. Firstly we need a <a href="http://mumble.sourceforge.net/">Mumble client</a> running on the same server as the Icecast server. Running a Mumble client requires a GUI and hence I had to install <a href="https://wiki.archlinux.org/index.php/GNOME">GNOME</a> on my headless Arch install (sigh!). Using the GUI I setup the Mumble client to automatically connect to the Mumble Server. Now I could just launch the Mumble client from command line.</p>
<p style="text-align: center;"><a href="http://chinpen.net/blog/wp-content/uploads/2013/11/mumble2.png"><img class="aligncenter size-medium wp-image-3732" alt="mumble2" src="http://chinpen.net/blog/wp-content/uploads/2013/11/mumble2-300x225.png" width="300" height="225" /></a></p>
<p>Next was getting the DarkIce to work. I got a lot of help from <a href="http://www.skyehaven.net/blog/2011/03/14/mumble-icecast/">this post on doing something similar</a>. DarkIce can pipe any Pulse Audio Stream to an IceCast server. So I created a dummy(null) Pulse Audio Stream which can be set as the audio output (System : Pulse Audio &amp; Device : Null Output) in the Mumble client and on the other end used to feed DarkIce using the ".monitor" functionality of Pulse Audio Streams. The DarkIce config in the repo has the relevant config setup.</p>
<p><img class="aligncenter size-medium wp-image-3739" alt="mumble" src="http://chinpen.net/blog/wp-content/uploads/2013/11/mumble1-300x285.png" width="300" height="285" /></p>
<p>With that setup in DarkIce and in the Mumble Client, we had the audio from the Mumble conversation happily being streamed out over Icecast. DarkIce also supported transcoding and streaming multiple streams (mp3 and ogg) to the Icecast server (Yay!).</p>
<p>I was cheap and lazy and ran all the servers on a single machine, but you can of course separate them on different boxes/VMs. This was the final setup..</p>
<p style="text-align: center;"><a href="http://chinpen.net/blog/wp-content/uploads/2013/10/Streaming-Setup-1.jpg"><img class="aligncenter size-medium wp-image-3725" alt="Streaming Setup" src="http://chinpen.net/blog/wp-content/uploads/2013/10/Streaming-Setup-1-300x225.jpg" width="480" height="360" /></a></p>
<p>With everything setup, I could enable/disable radio and Mumble streaming from command line. I had to do a final hack to allow the Arch to run GNOME even when no monitor was attached. I could do a VNC virtual display, but I did a <a href="http://blog.zorinaq.com/?e=11">more hardware hack</a> by making a "Fake Display" using some resistors on a VGA connector. This way I could connect a monitor anytime I wanted.</p>
<p><img class="aligncenter size-medium wp-image-3735" alt="monitor" src="http://chinpen.net/blog/wp-content/uploads/2013/11/monitor-300x294.jpg" width="300" height="294" /></p>
<p>I have uploaded all <a href="https://github.com/notthetup/webuildliveserver">my config scripts to a github repo </a>here. Feel free to ask any questions</p>
<p>And you can listen to radio streaming (when it's running) from the server here..</p>
<p><audio width="300" height="32" controls="controls" src="listen.webuild.sg:8000/radio"></audio></p>
